# ðŸš€ Cloudflare WAF Rules for Next.js Blog
# Copy these rules into your Cloudflare Dashboard â†’ Security â†’ WAF â†’ Firewall Rules

## Rule 1: Block Common Attack Patterns (HIGH PRIORITY)
# Expression:
(http.request.uri.path contains "/wp-admin") or
(http.request.uri.path contains "/wp-login") or
(http.request.uri.path contains "/phpmyadmin") or
(http.request.uri.path contains "/admin.php") or
(http.request.uri.path contains ".env") or
(http.request.uri.query contains "<script") or
(http.request.uri.query contains "eval(") or
(http.request.uri.query contains "union select") or
(http.request.uri.query contains "script>") or
(http.request.uri.query contains "javascript:")
# Action: Block
# Description: Block common web attacks and unauthorized admin access

## Rule 2: Block Automated Tools & Bad Bots (MEDIUM PRIORITY)
# Expression:
(http.user_agent contains "python") or
(http.user_agent contains "curl") or
(http.user_agent contains "wget") or
(http.user_agent contains "postman") or
(http.user_agent contains "burp") or
(http.user_agent contains "sqlmap") or
(http.user_agent contains "nikto") or
(http.user_agent contains "dirbuster") or
(http.user_agent contains "gobuster") or
(http.user_agent contains "masscan") or
(http.user_agent contains "zmap")
# Action: Managed Challenge
# Description: Challenge automated security testing tools

## Rule 3: Protect API Endpoints (MEDIUM PRIORITY)
# Expression:
(http.request.uri.path contains "/api") and
(not cf.bot_management.verified_bot) and
(http.request.method eq "POST" or http.request.method eq "PUT" or http.request.method eq "DELETE")
# Action: Managed Challenge
# Description: Protect API endpoints from unverified bots

## Rule 4: Block Suspicious File Upload Attempts (HIGH PRIORITY)
# Expression:
(http.request.uri.path contains "/api/upload") and
(http.request.method eq "POST") and
(not cf.bot_management.verified_bot) and
(cf.threat_score gt 20)
# Action: Block
# Description: Block suspicious file upload attempts

## Rule 5: Block Comment Spam (LOW PRIORITY)
# Expression:
(http.request.uri.path contains "/api/blog") and
(http.request.uri.path contains "/comments") and
(http.request.method eq "POST") and
(http.request.body contains "http://") and
(http.request.body contains "https://") and
(not cf.bot_management.verified_bot)
# Action: Managed Challenge
# Description: Challenge comment spam with links

## Rule 6: Rate Limit API Calls (MEDIUM PRIORITY)
# Expression:
(http.request.uri.path contains "/api") and
(http.request.method eq "POST")
# Action: Rate Limit (100 requests per minute per IP)
# Description: Rate limit API POST requests

## Rule 7: Allow Good Bots (LOW PRIORITY - ALLOW RULE)
# Expression:
(http.user_agent contains "Googlebot") or
(http.user_agent contains "Bingbot") or
(http.user_agent contains "Slurp") or
(http.user_agent contains "DuckDuckBot") or
(http.user_agent contains "Baiduspider") or
(http.user_agent contains "YandexBot") or
(http.user_agent contains "facebookexternalhit") or
(http.user_agent contains "Twitterbot") or
(http.user_agent contains "LinkedInBot") or
(http.user_agent contains "WhatsApp") or
(http.user_agent contains "TelegramBot")
# Action: Allow
# Description: Allow legitimate search engine and social media bots

## Rule 8: Block AI Training Bots (MEDIUM PRIORITY)
# Expression:
(http.user_agent contains "GPTBot") or
(http.user_agent contains "ChatGPT") or
(http.user_agent contains "ClaudeBot") or
(http.user_agent contains "Google-Extended") or
(http.user_agent contains "CCBot") or
(http.user_agent contains "Bytespider") or
(http.user_agent contains "PetalBot")
# Action: Block
# Description: Block AI training and scraping bots

## Rule 9: Block by ASN (Optional - HIGH PRIORITY)
# Expression:
(cf.ray_id contains "known-bad-asn") or
(ip.src.asnum eq 12345)  # Replace with actual bad ASN numbers
# Action: Block
# Description: Block traffic from known malicious ASNs

## Rule 10: Geo-Blocking (Optional - MEDIUM PRIORITY)
# Expression:
(ip.src.country eq "CN" and cf.threat_score gt 30) or
(ip.src.country eq "RU" and cf.threat_score gt 30) or
(ip.src.country eq "IN" and cf.threat_score gt 30)
# Action: Managed Challenge
# Description: Challenge high-threat traffic from certain countries

---

# ðŸ“‹ Rate Limiting Rules
# Go to Security â†’ Rate Limiting

## Rule 1: General Rate Limiting
# URL Pattern: *wasiq.in/*
# Requests per minute: 200
# Action: Block

## Rule 2: API Rate Limiting
# URL Pattern: *wasiq.in/api/*
# Requests per minute: 50
# Action: Block

## Rule 3: Upload Rate Limiting
# URL Pattern: *wasiq.in/api/upload*
# Requests per minute: 10
# Action: Block

---

# ðŸŽ¯ Bot Management Rules
# Go to Security â†’ Bots â†’ Bot Fight Mode

## Enable Bot Fight Mode: âœ…
## Verified Bots: âœ… Allow (Google, Bing, etc.)
## Bot Score Threshold: 30 (Block below this score)

---

# ðŸ“Š Monitoring Recommendations

1. **Security Analytics**: Monitor blocked requests daily
2. **Bot Analytics**: Track bot traffic patterns
3. **Firewall Events**: Review blocked traffic weekly
4. **Rate Limiting**: Check for false positives
5. **Performance**: Monitor site speed after enabling

---

# ðŸš¨ Emergency Rules (Enable during attacks)

## Emergency Block Rule:
# Expression: cf.threat_score gt 50
# Action: Block
# Description: Emergency block for high-threat traffic

## Emergency Challenge Rule:
# Expression: (http.request.uri.path contains "/admin") or (http.request.uri.path contains "/api")
# Action: Managed Challenge
# Description: Challenge all admin and API access during attacks
